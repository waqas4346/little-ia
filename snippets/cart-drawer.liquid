{%- doc -%}
  Renders the cart drawer, a slide-out panel that displays the contents of the cart. It includes the cart icon that acts as a trigger.

  @param {object} [settings] - An object containing theme settings.

  @param {boolean} [settings.auto_open_cart_drawer] - If `true`, the cart drawer opens automatically after an item is
  added.
  @param {string} [settings.drawer_color_scheme] - The color scheme for the drawer.
{%- enddoc -%}

<script
  src="{{ 'cart-drawer.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>
<script
  src="{{ 'cart-drawer-recommendations.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

<cart-drawer-component
  class="cart-drawer"
  {{ block.shopify_attributes }}
  {% if settings.auto_open_cart_drawer %}
    auto-open
  {% endif %}
>
  <button
    class="button header-actions__action button-unstyled"
    on:click="/open"
    aria-haspopup="dialog"
    aria-label="{{ 'accessibility.cart' | t }}"
    aria-describedby="cart-bubble-text"
    data-testid="cart-drawer-trigger"
  >
    {% render 'cart-icon-component' %}
  </button>

  <dialog
    ref="dialog"
    class="cart-drawer__dialog dialog-modal dialog-drawer color-{{ settings.drawer_color_scheme }}{% if cart.empty? %} cart-drawer--empty{%endif%}"
    aria-labelledby="{% if cart.empty? %}cart-drawer-heading-empty{% else %}cart-drawer-heading{% endif %}"
    scroll-lock
  >
    <div class="cart-drawer__inner">
      <cart-items-component
        class="cart-items-component"
        data-section-id="{{ section.id }}"
      >
        {%- if cart.empty? -%}
          <div class="cart-drawer__header">
            <button
              ref="closeButton"
              on:click="cart-drawer-component/close"
              class="button close-button cart-drawer__close-button button-unstyled"
              aria-label="{{ 'actions.close_dialog' | t }}"
            >
              <span class="svg-wrapper">
                {{- 'icon-close.svg' | inline_asset_content -}}
              </span>
            </button>
          </div>

          <div
            class="cart-drawer__content motion-reduce"
            aria-label="{{ 'accessibility.cart' | t }}"
          >
            <h2
              class="cart-drawer__heading h3 cart-drawer__heading--empty"
              id="cart-drawer-heading-empty"
            >
              {{ 'content.your_cart_is_empty' | t }}
            </h2>

            <div class="cart-drawer__items">
              {% render 'cart-products', drawer_context: 'drawer' %}
            </div>
          </div>
        {%- else -%}
          <div
            class="cart-drawer__header"
            id="cart-drawer-header"
          >
            <h2
              class="cart-drawer__heading h3"
              id="cart-drawer-heading"
            >
              {{ 'content.cart_title' | t }}
              <span class="cart-drawer__item-count">
                ({{ cart.item_count }} Items)
              </span>
            </h2>

            <button
              ref="closeButton"
              on:click="cart-drawer-component/close"
              class="button close-button cart-drawer__close-button button-unstyled"
              aria-label="{{ 'actions.close_dialog' | t }}"
            >
              <span class="svg-wrapper">
                {{- 'icon-close.svg' | inline_asset_content -}}
              </span>
            </button>
          </div>

          {% if settings.show_free_shipping_progress %}
            {% render 'free-shipping-progress' %}
          {% endif %}

          <div
            class="cart-drawer__content motion-reduce"
            aria-label="{{ 'accessibility.cart' | t }}"
            style="--header-height: 60px;"
          >
            <scroll-hint
              class="cart-drawer__items"
            >
              {% render 'cart-products', drawer_context: 'drawer' %}

            {%- liquid
              assign gift_wrap_product = settings.gift_wrap_product
              assign show_gift_wrap_prompt = false
              assign show_gift_wrap_assignments = false

              if gift_wrap_product != blank and cart.items.size > 0
                assign has_non_gift_items = false
                assign has_gift_wrap_in_cart = false

                for item in cart.items
                  if item.product_id == gift_wrap_product.id
                    assign has_gift_wrap_in_cart = true
                  else
                    assign has_non_gift_items = true
                  endif
                endfor

                if has_non_gift_items and has_gift_wrap_in_cart == false
                  assign show_gift_wrap_prompt = true
                endif

                if has_gift_wrap_in_cart
                  assign show_gift_wrap_assignments = true
                endif
              endif
            -%}

            {%- if show_gift_wrap_prompt -%}
              <div class="cart-drawer-gift-wrap" data-cart-drawer-gift-wrap>
                <div class="cart-drawer-gift-wrap__media">
                  {%- if gift_wrap_product.featured_media -%}
                    {{
                      gift_wrap_product.featured_media
                      | image_url: width: 160
                      | image_tag: loading: 'lazy', class: 'cart-drawer-gift-wrap__image', alt: gift_wrap_product.title
                    }}
                  {%- endif -%}
                </div>
                <div class="cart-drawer-gift-wrap__details">
                  <p class="cart-drawer-gift-wrap__title">{{ gift_wrap_product.title }}</p>
                  <p class="cart-drawer-gift-wrap__price">{{ gift_wrap_product.price | money }}</p>
                  <div class="cart-drawer-gift-wrap__actions">
                    <button
                      type="button"
                      class="button cart-drawer-gift-wrap__add"
                      data-add-gift-wrap-drawer
                      data-gift-variant-id="{{ gift_wrap_product.selected_or_first_available_variant.id }}"
                      aria-label="Add {{ gift_wrap_product.title | escape }}"
                    >
                      Add
                    </button>
                    <span class="cart-drawer-gift-wrap__remove" aria-hidden="true">Remove</span>
                  </div>
                </div>
              </div>
            {%- endif -%}

            {%- if show_gift_wrap_assignments -%}
              <div class="cart-drawer-gift-assignments" data-cart-drawer-gift-assignments>
                {%- assign wrapper_index = 0 -%}
                {%- for item in cart.items -%}
                  {%- if item.product_id == gift_wrap_product.id -%}
                    {%- assign wrapper_index = wrapper_index | plus: 1 -%}
                    {%- assign wrapper_instance_id = item.properties['_gift_wrap_instance_id'] | default: item.properties['Gift Wrap Instance'] | default: item.key -%}
                    {%- assign wrapper_message = item.properties['_gift_wrap_message'] -%}
                    {%- assign wrapper_message_normalized = wrapper_message | strip | downcase -%}
                    {%- if wrapper_message_normalized == 'no gift message added yet.' -%}
                      {%- assign wrapper_message = '' -%}
                    {%- endif -%}
                    <div
                      class="cart-drawer-gift-assignment-card"
                      data-wrapper-id="{{ wrapper_instance_id | escape }}"
                      data-gift-wrap-cart-key="{{ item.key | escape }}"
                      data-gift-wrap-variant-id="{{ item.variant.id }}"
                      data-gift-wrap-line-quantity="{{ item.quantity }}"
                      data-gift-wrap-line-properties="{{ item.properties | json | escape }}"
                    >
                      <div class="cart-drawer-gift-assignment-card__header">
                        <span class="cart-drawer-gift-assignment-card__index">{{ wrapper_index }}</span>
                        <p class="cart-drawer-gift-assignment-card__title">Create {{ wrapper_index }}{% if wrapper_index == 1 %}st{% elsif wrapper_index == 2 %}nd{% elsif wrapper_index == 3 %}rd{% else %}th{% endif %} gift wrap</p>
                      </div>

                      <div class="cart-drawer-gift-assignment-card__section">
                        <p class="cart-drawer-gift-assignment-card__label">Gift Message:</p>
                        {% if wrapper_message != blank %}
                          <button
                            type="button"
                            class="cart-items__edit-personalization button-unstyled has-summary cart-drawer-gift-assignment-card__edit-personalization"
                            data-edit-gift-wrap-message
                            data-cart-line="{{ item.index | plus: 1 }}"
                            data-cart-key="{{ item.key | escape }}"
                            data-cart-line-quantity="{{ item.quantity }}"
                            data-wrapper-id="{{ wrapper_instance_id | escape }}"
                            data-current-message="{{ wrapper_message | escape }}"
                            data-line-properties="{{ item.properties | json | escape }}"
                          >
                            <span class="cart-drawer-gift-assignment-card__message-summary">
                              {{- wrapper_message | strip -}}
                            </span>
                           <div class="icon-tex-container">
                      <span class="cart-items__edit-personalization-icon">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                          <rect width="18" height="18" fill="url(#pattern0_860_35083)"/>
                          <defs>
                          <pattern id="pattern0_860_35083" patternContentUnits="objectBoundingBox" width="1" height="1">
                          <use xlink:href="#image0_860_35083" transform="scale(0.00195312)"/>
                          </pattern>
                          <image id="image0_860_35083" width="512" height="512" preserveAspectRatio="none" xlink:href="data:image/png;base64,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"/>
                          </defs>
                        </svg>
                      </span>
                      <span class="cart-items__edit-personalization-text">EDIT</span>
                    </div>
                          </button>
                        {% else %}
                          <button
                            type="button"
                            class="cart-drawer-gift-assignment-card__add-message"
                            data-edit-gift-wrap-message
                            data-cart-line="{{ item.index | plus: 1 }}"
                            data-cart-key="{{ item.key | escape }}"
                            data-cart-line-quantity="{{ item.quantity }}"
                            data-wrapper-id="{{ wrapper_instance_id | escape }}"
                            data-current-message=""
                            data-line-properties="{{ item.properties | json | escape }}"
                          >
                            Add
                          </button>
                        {% endif %}
                      </div>

                      {%- assign assigned_count = 0 -%}
                      {%- for product_item in cart.items -%}
                        {%- assign product_wrapper_instance_id = product_item.properties['_gift_wrap_instance_id'] | default: product_item.properties['Gift Wrap Instance'] -%}
                        {%- if product_item.product_id != gift_wrap_product.id and product_wrapper_instance_id == wrapper_instance_id -%}
                          {%- assign assigned_count = assigned_count | plus: 1 -%}
                        {%- endif -%}
                      {%- endfor -%}

                      <div class="cart-drawer-gift-assignment-card__section">
                        <p class="cart-drawer-gift-assignment-card__label">Gift Items:</p>
                        {%- if assigned_count > 0 -%}
                          <div class="cart-drawer-gift-assignment-list">
                            {%- for product_item in cart.items -%}
                              {%- assign product_wrapper_instance_id = product_item.properties['_gift_wrap_instance_id'] | default: product_item.properties['Gift Wrap Instance'] -%}
                              {%- if product_item.product_id != gift_wrap_product.id and product_wrapper_instance_id == wrapper_instance_id -%}
                                <div class="cart-drawer-gift-assignment-item">
                                  <div class="cart-drawer-gift-assignment-item__media">
                                    {%- if product_item.image -%}
                                      {{
                                        product_item.image
                                        | image_url: width: 120
                                        | image_tag: loading: 'lazy', class: 'cart-drawer-gift-assignment-item__image', alt: product_item.product.title
                                      }}
                                    {%- endif -%}
                                  </div>
                                  <div class="cart-drawer-gift-assignment-item__details">
                                    <p class="cart-drawer-gift-assignment-item__title">{{ product_item.product.title }}</p>
                                    {%- if product_item.options_with_values.size > 0 -%}
                                      <p class="cart-drawer-gift-assignment-item__variant">
                                        {%- for option in product_item.options_with_values -%}
                                          {{ option.value }}{% unless forloop.last %}, {% endunless %}
                                        {%- endfor -%}
                                      </p>
                                    {%- endif -%}
                                  </div>
                                </div>
                              {%- endif -%}
                            {%- endfor -%}
                          </div>
                        {%- else -%}
                          <p class="cart-drawer-gift-assignment-card__empty">No products assigned yet.</p>
                        {%- endif -%}
                      </div>

                      {%- assign unassigned_count = 0 -%}
                      {%- for product_item in cart.items -%}
                        {%- if product_item.product_id != gift_wrap_product.id and product_item.properties['_gift_wrap_instance_id'] == blank and product_item.properties['Gift Wrap Instance'] == blank -%}
                          {%- assign unassigned_count = unassigned_count | plus: 1 -%}
                        {%- endif -%}
                      {%- endfor -%}
                      {%- if unassigned_count > 0 -%}
                        <div class="cart-drawer-gift-assignment-card__section">
                          <p class="cart-drawer-gift-assignment-card__label">Add Gift Items:</p>
                          <div class="cart-drawer-gift-assignment-list">
                            {%- for product_item in cart.items -%}
                              {%- if product_item.product_id != gift_wrap_product.id and product_item.properties['_gift_wrap_instance_id'] == blank and product_item.properties['Gift Wrap Instance'] == blank -%}
                                <div class="cart-drawer-gift-assignment-item">
                                  <div class="cart-drawer-gift-assignment-item__media">
                                    {%- if product_item.image -%}
                                      {{
                                        product_item.image
                                        | image_url: width: 120
                                        | image_tag: loading: 'lazy', class: 'cart-drawer-gift-assignment-item__image', alt: product_item.product.title
                                      }}
                                    {%- endif -%}
                                  </div>
                                  <div class="cart-drawer-gift-assignment-item__details">
                                    <p class="cart-drawer-gift-assignment-item__title">{{ product_item.product.title }}</p>
                                    {%- if product_item.options_with_values.size > 0 -%}
                                      <p class="cart-drawer-gift-assignment-item__variant">
                                        {%- for option in product_item.options_with_values -%}
                                          {{ option.value }}{% unless forloop.last %}, {% endunless %}
                                        {%- endfor -%}
                                      </p>
                                    {%- endif -%}
                                  </div>
                                  <button
                                    type="button"
                                    class="button-unstyled cart-drawer-gift-assignment-item__add"
                                    data-assign-gift-wrap
                                    data-wrapper-id="{{ wrapper_instance_id | escape }}"
                                    data-cart-line="{{ product_item.index | plus: 1 }}"
                                    data-cart-key="{{ product_item.key | escape }}"
                                    data-cart-line-quantity="{{ product_item.quantity }}"
                                    data-line-properties="{{ product_item.properties | json | escape }}"
                                    aria-label="Assign {{ product_item.product.title | escape }}"
                                  >
                                    +
                                  </button>
                                </div>
                              {%- endif -%}
                            {%- endfor -%}
                          </div>
                        </div>
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                {%- endfor -%}
              </div>
            {%- endif -%}
            </scroll-hint>

            {% render 'cart-drawer-recommendations' %}

            <div
              class="cart-drawer__summary"
            >
              <div class="cart-drawer__summary-inner">
                {% render 'cart-summary' %}
              </div>
            </div>
          </div>

          <dialog
            class="personalise-modal cart-drawer-gift-message-dialog"
            data-gift-message-modal
            aria-labelledby="gift-message-modal-title"
          >
            <button
              type="button"
              class="button button-unstyled close-button personalise-modal__close"
              data-close-gift-message-modal
              aria-label="Close gift message modal"
            >
              {{- 'icon-close.svg' | inline_asset_content -}}
            </button>
            <div class="personalise-modal__content">
              <div class="personalise-modal__form cart-drawer-gift-message-modal__form">
                <h2 class="personalise-modal__title" id="gift-message-modal-title">
                  <span class="personalise-modal__title-icon">
                    <img src="{{ 'edit_image.png' | asset_url }}" alt="" width="16" height="16">
                  </span>
                  <span>Gift Message</span>
                </h2>
                <div class="personalise-modal__field">
                  <label class="personalise-modal__label">Enter your message</label>
                  <textarea
                    class="personalise-modal__textarea cart-drawer-gift-message-modal__textarea"
                    data-gift-message-textarea
                    maxlength="300"
                    rows="5"
                    placeholder="Enter gift message"
                  ></textarea>
                </div>
                <div class="personalise-modal__actions">
                  <button type="button" class="personalise-modal__save-button button button--primary" data-save-gift-message disabled>
                    Save
                  </button>
                  <button
                    type="button"
                    class="personalise-modal__cancel-button button button-unstyled"
                    data-close-gift-message-modal
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </dialog>
          
          {%- comment -%} Personalise Modal for cart editing {%- endcomment -%}
          {%- if cart.items.size > 0 -%}
            {%- assign first_item_with_personalization = null -%}
            {%- for item in cart.items -%}
              {%- liquid
                assign has_personalization = false
                assign personalization_keys = "Name,Name 1,Name 2,Name 3,Name 4,Baby's Name,Kid's Name,Mum's Name,Date of Birth,Personalise Date of Birth,Text Color,Text Font,School Year,Personalisation:,Message,Time,Weight" | split: ','
                for property in item.properties
                  assign property_first_char = property.first | slice: 0
                  if property.last != blank and property_first_char != '_'
                    for key in personalization_keys
                      if property.first == key
                        assign has_personalization = true
                        break
                      endif
                    endfor
                  endif
                  if has_personalization
                    break
                  endif
                endfor
              -%}
              {%- if has_personalization and first_item_with_personalization == null -%}
                {%- assign first_item_with_personalization = item -%}
                {%- break -%}
              {%- endif -%}
            {%- endfor -%}
            {%- if first_item_with_personalization -%}
              {% render 'personalise-modal', product: first_item_with_personalization.product, variant: first_item_with_personalization.variant, context: 'cart-drawer' %}
              <script src="{{ 'personalise-modal.js' | asset_url }}" type="module"></script>
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
      </cart-items-component>
    </div>
  </dialog>
</cart-drawer-component>

{% javascript %}
  const giftWrapButtonSelector = '[data-add-gift-wrap-drawer]';
  const assignButtonSelector = '[data-assign-gift-wrap]';
  const unassignButtonSelector = '[data-unassign-gift-wrap]';
  const editMessageButtonSelector = '[data-edit-gift-wrap-message]';
  const saveMessageButtonSelector = '[data-save-gift-message]';
  const closeMessageButtonSelector = '[data-close-gift-message-modal]';
  const messageTextareaSelector = '[data-gift-message-textarea]';
  const messageModalSelector = '[data-gift-message-modal]';
  const giftWrapCardSelector = '[data-gift-wrap-cart-key]';
  const loadingClass = 'is-loading';
  const giftWrapDrawerState = (window.__giftWrapDrawerState = window.__giftWrapDrawerState || {
    isNormalizingGiftWrapLines: false,
    normalizeTimer: null,
    messageContext: null,
  });

  function getSectionIds() {
    return Array.from(document.querySelectorAll('cart-items-component[data-section-id]'))
      .map((element) => element.dataset.sectionId)
      .filter(Boolean);
  }

  function triggerCartUpdate(sections) {
    document.dispatchEvent(
      new CustomEvent('cart:update', {
        bubbles: true,
        detail: {
          sourceId: 'cart-drawer-gift-wrap',
          data: {
            source: 'cart-drawer-gift-wrap',
            sections: sections || {},
          },
        },
      })
    );
  }

  function parseLineProperties(serializedProperties) {
    if (!serializedProperties) return {};
    try {
      const parsed = JSON.parse(serializedProperties);
      if (!parsed || typeof parsed !== 'object') return {};
      return parsed;
    } catch (error) {
      console.error('Failed to parse line properties', error);
      return {};
    }
  }

  function normalizeProperties(properties) {
    if (!properties || typeof properties !== 'object') return {};
    const normalized = {};
    for (const [key, value] of Object.entries(properties)) {
      if (!key) continue;
      if (value === null || value === undefined) continue;
      if (typeof value === 'object') continue;
      normalized[key] = String(value);
    }
    return normalized;
  }

  function generateWrapperInstanceId() {
    return `gw_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;
  }

  function getGiftMessageModalElements() {
    const modal = document.querySelector(messageModalSelector);
    if (!(modal instanceof HTMLDialogElement)) return null;
    const textarea = modal.querySelector(messageTextareaSelector);
    const saveButton = modal.querySelector(saveMessageButtonSelector);
    if (!(textarea instanceof HTMLTextAreaElement)) return null;
    if (!(saveButton instanceof HTMLButtonElement)) return null;
    return { modal, textarea, saveButton };
  }

  function updateGiftMessageSaveButtonState() {
    const modalElements = getGiftMessageModalElements();
    if (!modalElements) return;
    const hasValue = modalElements.textarea.value.trim().length > 0;
    modalElements.saveButton.disabled = !hasValue;
  }

  function openGiftMessageModal(button) {
    const modalElements = getGiftMessageModalElements();
    if (!modalElements) return;

    giftWrapDrawerState.messageContext = {
      line: button.dataset.cartLine || '',
      key: button.dataset.cartKey || '',
      quantity: button.dataset.cartLineQuantity || '',
      wrapperId: button.dataset.wrapperId || '',
      properties: parseLineProperties(button.dataset.lineProperties),
    };

    modalElements.textarea.value = button.dataset.currentMessage || '';
    if (!modalElements.modal.open) {
      modalElements.modal.showModal();
    }
    updateGiftMessageSaveButtonState();
    window.setTimeout(() => {
      modalElements.textarea.focus();
      modalElements.textarea.setSelectionRange(modalElements.textarea.value.length, modalElements.textarea.value.length);
    }, 0);
  }

  function closeGiftMessageModal() {
    const modalElements = getGiftMessageModalElements();
    if (!modalElements) return;
    if (modalElements.modal.open) {
      modalElements.modal.close();
    }
    giftWrapDrawerState.messageContext = null;
  }

  async function saveGiftMessageFromModal(button) {
    const modalElements = getGiftMessageModalElements();
    const context = giftWrapDrawerState.messageContext;
    if (!modalElements || !context) return;
    if (!context.line || !context.quantity) return;

    const properties = { ...context.properties };
    const trimmed = modalElements.textarea.value.trim();

    // Preserve wrapper identity so assigned items stay linked after message updates.
    if (context.wrapperId) {
      if (!properties._gift_wrap_instance_id) {
        properties._gift_wrap_instance_id = context.wrapperId;
      }
      if (!properties['Gift Wrap Instance']) {
        properties['Gift Wrap Instance'] = context.wrapperId;
      }
    }

    if (trimmed) {
      properties._gift_wrap_message = trimmed;
    } else {
      delete properties._gift_wrap_message;
    }

    await updateCartLine({
      line: context.line,
      key: context.key,
      quantity: context.quantity,
      properties,
    });
    closeGiftMessageModal();
  }

  async function updateCartLine({ line, key, quantity, properties }) {
    const sectionIds = getSectionIds();
    const payload = {
      quantity: Number(quantity),
      properties: normalizeProperties(properties),
      sections: sectionIds.join(','),
      sections_url: window.location.pathname,
    };
    if (key) {
      payload.id = key;
    } else {
      payload.line = Number(line);
    }

    const response = await fetch('/cart/change.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload),
    });

    if (!response.ok) {
      let serverError = 'Failed to update cart line';
      try {
        const errorData = await response.json();
        serverError = errorData?.description || errorData?.message || serverError;
      } catch (error) {
        // Keep fallback message when response is not JSON.
      }
      throw new Error(serverError);
    }

    const responseData = await response.json();
    triggerCartUpdate(responseData?.sections);
  }

  async function handleAddGiftWrap(button) {
    const variantId = button.dataset.giftVariantId;
    if (!variantId) return;

    const sectionIds = getSectionIds();
    const uniqueInstanceId = generateWrapperInstanceId();
    const response = await fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        id: Number(variantId),
        quantity: 1,
        properties: {
          _gift_wrap_source: 'cart_drawer',
          _gift_wrap_instance_id: uniqueInstanceId,
          'Gift Wrap Instance': uniqueInstanceId,
        },
        sections: sectionIds.join(','),
        sections_url: window.location.pathname,
      }),
    });

    if (!response.ok) {
      throw new Error('Failed to add gift wrap');
    }

    const responseData = await response.json();
    triggerCartUpdate(responseData?.sections);
  }

  async function handleAssignProduct(button) {
    const line = button.dataset.cartLine;
    const key = button.dataset.cartKey;
    const quantity = button.dataset.cartLineQuantity;
    const wrapperId = button.dataset.wrapperId;
    if (!line || !quantity || !wrapperId) return;

    const properties = parseLineProperties(button.dataset.lineProperties);
    properties._gift_wrap_instance_id = wrapperId;
    properties['Gift Wrap Instance'] = wrapperId;

    await updateCartLine({
      line,
      key,
      quantity,
      properties,
    });
  }

  async function handleUnassignProduct(button) {
    const line = button.dataset.cartLine;
    const key = button.dataset.cartKey;
    const quantity = button.dataset.cartLineQuantity;
    if (!line || !quantity) return;

    const properties = parseLineProperties(button.dataset.lineProperties);
    delete properties._gift_wrap_instance_id;
    delete properties['Gift Wrap Instance'];

    await updateCartLine({
      line,
      key,
      quantity,
      properties,
    });
  }

  async function normalizeGiftWrapLines() {
    if (giftWrapDrawerState.isNormalizingGiftWrapLines) return false;

    const cards = Array.from(document.querySelectorAll(giftWrapCardSelector));
    if (!cards.length) return false;

    const linesByKey = new Map();
    for (const card of cards) {
      const key = card.getAttribute('data-gift-wrap-cart-key');
      if (!key || linesByKey.has(key)) continue;

      const quantity = Number(card.getAttribute('data-gift-wrap-line-quantity') || '0');
      const variantId = Number(card.getAttribute('data-gift-wrap-variant-id') || '0');
      const properties = parseLineProperties(card.getAttribute('data-gift-wrap-line-properties') || '');
      linesByKey.set(key, { key, quantity, variantId, properties });
    }

    const linesToSplit = Array.from(linesByKey.values()).filter((lineData) => lineData.quantity > 1 && lineData.variantId > 0);
    if (!linesToSplit.length) return false;

    giftWrapDrawerState.isNormalizingGiftWrapLines = true;
    try {
      const sectionIds = getSectionIds();
      let latestSections = {};

      for (const lineData of linesToSplit) {
        const currentProperties = normalizeProperties(lineData.properties);
        const primaryWrapperInstanceId =
          currentProperties._gift_wrap_instance_id || currentProperties['Gift Wrap Instance'] || generateWrapperInstanceId();
        const primaryLineProperties = {
          ...currentProperties,
          _gift_wrap_source: currentProperties._gift_wrap_source || 'cart_drawer',
          _gift_wrap_instance_id: primaryWrapperInstanceId,
          'Gift Wrap Instance': primaryWrapperInstanceId,
        };

        // Keep one line item as quantity 1 and normalize its properties.
        const primaryLineResponse = await fetch('/cart/change.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: lineData.key,
            quantity: 1,
            properties: primaryLineProperties,
            sections: sectionIds.join(','),
            sections_url: window.location.pathname,
          }),
        });
        if (!primaryLineResponse.ok) {
          throw new Error('Failed to normalize primary gift wrap line');
        }
        const primaryLineData = await primaryLineResponse.json();
        latestSections = primaryLineData?.sections || latestSections;

        // Add only the additional wrappers needed.
        const additionalWrappers = lineData.quantity - 1;
        const baseProperties = { ...currentProperties };
        delete baseProperties._gift_wrap_instance_id;
        delete baseProperties['Gift Wrap Instance'];
        delete baseProperties._gift_wrap_message;

        const addRequests = [];
        for (let index = 0; index < additionalWrappers; index += 1) {
          const wrapperInstanceId = generateWrapperInstanceId();
          addRequests.push(
            fetch('/cart/add.js', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                id: lineData.variantId,
                quantity: 1,
                properties: {
                  ...baseProperties,
                  _gift_wrap_source: baseProperties._gift_wrap_source || 'cart_drawer',
                  _gift_wrap_instance_id: wrapperInstanceId,
                  'Gift Wrap Instance': wrapperInstanceId,
                },
                sections: sectionIds.join(','),
                sections_url: window.location.pathname,
              }),
            })
          );
        }

        const addResponses = await Promise.all(addRequests);
        for (const response of addResponses) {
          if (!response.ok) {
            throw new Error('Failed to split gift wrap line');
          }
          const responseData = await response.json();
          latestSections = responseData?.sections || latestSections;
        }
      }

      triggerCartUpdate(latestSections);
      return true;
    } catch (error) {
      console.error('Gift wrap normalization failed', error);
      return false;
    } finally {
      giftWrapDrawerState.isNormalizingGiftWrapLines = false;
    }
  }

  function scheduleNormalizeGiftWrapLines(delay = 40) {
    if (giftWrapDrawerState.normalizeTimer) {
      window.clearTimeout(giftWrapDrawerState.normalizeTimer);
    }
    giftWrapDrawerState.normalizeTimer = window.setTimeout(() => {
      giftWrapDrawerState.normalizeTimer = null;
      normalizeGiftWrapLines();
    }, delay);
  }

  const handleGiftWrapDrawerClick = async (event) => {
    const button = event.target.closest(
      `${giftWrapButtonSelector}, ${assignButtonSelector}, ${unassignButtonSelector}, ${editMessageButtonSelector}, ${saveMessageButtonSelector}, ${closeMessageButtonSelector}`
    );
    if (!(button instanceof HTMLButtonElement)) return;

    event.preventDefault();

    if (button.matches(closeMessageButtonSelector)) {
      closeGiftMessageModal();
      return;
    }

    if (button.matches(editMessageButtonSelector)) {
      openGiftMessageModal(button);
      return;
    }

    if (button.disabled) return;
    if (giftWrapDrawerState.isNormalizingGiftWrapLines) return;

    button.disabled = true;
    button.classList.add(loadingClass);

    try {
      const normalized = await normalizeGiftWrapLines();
      if (normalized) return;

      if (button.matches(giftWrapButtonSelector)) {
        await handleAddGiftWrap(button);
      } else if (button.matches(assignButtonSelector)) {
        await handleAssignProduct(button);
      } else if (button.matches(unassignButtonSelector)) {
        await handleUnassignProduct(button);
      } else if (button.matches(saveMessageButtonSelector)) {
        await saveGiftMessageFromModal(button);
      }
    } catch (error) {
      console.error('Gift wrap drawer action failed', error);
    } finally {
      button.disabled = false;
      button.classList.remove(loadingClass);
    }
  };

  if (window.__giftWrapDrawerClickHandler) {
    document.removeEventListener('click', window.__giftWrapDrawerClickHandler);
  }
  window.__giftWrapDrawerClickHandler = handleGiftWrapDrawerClick;
  document.addEventListener('click', window.__giftWrapDrawerClickHandler);

  const handleGiftWrapDrawerCartUpdate = () => {
    closeGiftMessageModal();
    scheduleNormalizeGiftWrapLines(120);
  };
  if (window.__giftWrapDrawerCartUpdateHandler) {
    document.removeEventListener('cart:update', window.__giftWrapDrawerCartUpdateHandler);
  }
  window.__giftWrapDrawerCartUpdateHandler = handleGiftWrapDrawerCartUpdate;
  document.addEventListener('cart:update', window.__giftWrapDrawerCartUpdateHandler);

  const handleGiftWrapDrawerInput = (event) => {
    const target = event.target;
    if (!(target instanceof HTMLTextAreaElement)) return;
    if (!target.matches(messageTextareaSelector)) return;
    updateGiftMessageSaveButtonState();
  };
  if (window.__giftWrapDrawerInputHandler) {
    document.removeEventListener('input', window.__giftWrapDrawerInputHandler);
  }
  window.__giftWrapDrawerInputHandler = handleGiftWrapDrawerInput;
  document.addEventListener('input', window.__giftWrapDrawerInputHandler);

  scheduleNormalizeGiftWrapLines(0);
{% endjavascript %}

{% stylesheet %}
  .cart-items-component {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;

    .cart-items__variant dd {
      font-weight: 300;
    }

    .cart-items__table-row {
      column-gap: 6px;
      margin-bottom: 0px !important;
    }

    .cart-items__quantity {
      width: 100%;
    }

    .cart-items__quantity-controls {
      width: 100%;
      justify-content: space-between;
    }

    .quantity-selector {
      --quantity-selector-width: 72px;

      flex: 1 1 var(--quantity-selector-width);
    }

    .quantity-selector :is(.quantity-minus, .quantity-plus) {
      --minimum-touch-target: 26px;

      width: var(--minimum-touch-target);
      height: var(--minimum-touch-target);
    }

    .quantity-selector input[type=number] {
      --minimum-touch-target: 26px;
      max-width: calc(var(--quantity-selector-width) - var(--minimum-touch-target) * 2);
    }

    .cart-items__remove {
      width: unset;
      height: unset;
      color: #959595;
      font-weight: 400;
      font-size: 14px;
      line-height: 100%;
      text-decoration: underline;
    }
  }

  .cart-drawer__heading .cart-bubble {
    width: fit-content;
    border-radius: var(--style-border-radius-buttons-primary);
    aspect-ratio: auto;
    padding: var(--cart-padding);
  }

  .cart-drawer__heading .cart-bubble[data-maintain-ratio] {
    aspect-ratio: 1;
    min-width: 26px;
  }

  .cart-drawer__header {
    background-color: var(--color-background);
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: var(--cart-drawer-padding);
    border-bottom: var(--style-border-width) solid none;
    position: sticky;
    top: 0;
    z-index: 1;
    border-bottom: 0.5px solid #DDDDDD;
    padding-top: 14px !important;
    padding-bottom: 14px !important;

    .close-button {
      right: 23px;
      width: unset;
      height: unset;
    }

    @media screen and (min-width: 750px) {
      padding: var(--cart-drawer-padding-desktop);
    }
  }

  .cart-drawer-gift-wrap {
    display: flex;
    gap: 12px;
    margin: 12px 0;
    padding: 12px;
    background: #ffffff;
    align-items: center;
  }

  .cart-drawer-gift-wrap__media {
    width: 88px;
    min-width: 88px;
    height: 88px;
  }

  .cart-drawer-gift-wrap__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .cart-drawer-gift-wrap__details {
    flex: 1;
    min-width: 0;
  }

  .cart-drawer-gift-wrap__title {
    margin: 0 0 6px;
    font-family: 'Outfit', sans-serif;
    font-weight: 500;
    font-size: 16px;
    line-height: 140%;
    letter-spacing: 0;
    color: #1f364d;
  }

  .cart-drawer-gift-wrap__price {
    margin: 0 0 10px;
    font-family: 'Outfit', sans-serif;
    font-weight: 500;
    font-size: 14px;
    line-height: 160%;
    letter-spacing: 0;
    color: #1f364d;
  }

  .cart-drawer-gift-wrap__actions {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .cart-drawer-gift-wrap__add {
    text-transform: uppercase;
    font-family: 'Outfit', sans-serif;
    font-weight: 500;
    font-size: 14.94px;
    line-height: 100%;
    letter-spacing: 0;
    padding: 4px 20px;
    background: #7f9ec3;
    border-color: #7f9ec3;
    color: #fff;
  }

  .cart-drawer-gift-wrap__add[disabled] {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .cart-drawer-gift-wrap__remove {
    display: none;
    margin-left: auto;
    font-weight: 400;
    font-size: 14px;
    line-height: 100%;
    letter-spacing: 0;
    color: #959595;
    text-decoration: underline;
    text-transform: uppercase;
    cursor: pointer;
  }

  .cart-drawer-gift-assignments {
    display: grid;
    gap: 12px;
    margin-bottom: 12px;
    margin-top: 12px;
  }

  .cart-drawer-gift-assignment-card {
    border: 1px solid #7295bb;
    padding: 12px;
    background: #fff;
  }

  .cart-drawer-gift-assignment-card__header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .cart-drawer-gift-assignment-card__index {
    width: 19px;
    height: 19px;
    border-radius: 2px;
    background: #7295bb;
    color: #fff;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 600;
  }

  .cart-drawer-gift-assignment-card__title {
    margin: 0;
    font-family: 'Outfit', sans-serif;
    font-weight: 400;
    font-size: 14px;
    line-height: 140%;
    letter-spacing: 0;
    vertical-align: middle;
    color: #1d425a;
  }

  .cart-drawer-gift-assignment-card__section {
    margin-top: 10px;
  }

  .cart-drawer-gift-assignment-card__label {
    margin: 0 0 8px;
    font-family: 'Outfit', sans-serif;
    font-weight: 500;
    font-size: 14px;
    line-height: 140%;
    letter-spacing: 0;
    vertical-align: middle;
    color: #1d425a;
  }

  .cart-drawer-gift-assignment-card__message-summary {
    white-space: pre-line;
    overflow: visible;
    text-overflow: initial;
    word-break: break-word;
    text-transform: none;
    font-family: 'Outfit', sans-serif;
    font-weight: 400;
    font-size: 12px;
    letter-spacing: 0;
    text-align: left;
    color: #1d425a;
  }

  .cart-drawer-gift-assignment-card__add-message {
    display: inline-block;
    cursor: pointer;
    text-transform: uppercase;
    font-family: 'Outfit', sans-serif;
    font-weight: 500;
    font-size: 14.94px;
    line-height: 100%;
    letter-spacing: 0;
    padding: 4px 20px;
    background: #7f9ec3;
    border: 1px solid #7f9ec3;
    color: #fff;
    border-radius: 0;
    box-shadow: none;
    white-space: nowrap;
  }

  .cart-drawer-gift-assignment-card__add-message:hover,
  .cart-drawer-gift-assignment-card__add-message:focus-visible,
  .cart-drawer-gift-assignment-card__add-message:active {
    color: #fff;
    background: #7f9ec3;
    border-color: #7f9ec3;
  }

  .cart-drawer-gift-assignment-list {
    display: grid;
    gap: 10px;
  }

  .cart-drawer-gift-assignment-item {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .cart-drawer-gift-assignment-item__media {
    width: 55px;
    min-width: 55px;
    height: 55px;
    position: relative;
    overflow: hidden;
    background: linear-gradient(0deg, rgb(0 0 0 / 2%), rgb(0 0 0 / 2%));
  }

  .cart-drawer-gift-assignment-item__media::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(0deg, rgb(0 0 0 / 2%), rgb(0 0 0 / 2%));
    pointer-events: none;
    z-index: 1;
  }

  .cart-drawer-gift-assignment-item__image {
    position: relative;
    z-index: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .cart-drawer-gift-assignment-item__details {
    min-width: 0;
    flex: 1;
  }

  .cart-drawer-gift-assignment-item__title {
    margin: 0;
    font-family: 'Outfit', sans-serif;
    font-weight: 500;
    font-size: 14px;
    line-height: 140%;
    letter-spacing: 0;
    color: #1f364d;
  }

  .cart-drawer-gift-assignment-item__variant {
    margin: 4px 0 0;
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    line-height: 1.2;
    color: #1f364d;
  }

  .cart-drawer-gift-assignment-item__add {
    width: 30px;
    height: 30px;
    border: 1px solid #7295bb;
    border-radius: 50%;
    color: #7295bb;
    font-size: 24px;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: auto;
  }

  .cart-drawer-gift-assignment-item__remove {
    margin-left: auto;
    color: #8e8e8e;
    text-decoration: underline;
    font-family: 'Outfit', sans-serif;
    font-size: 13px;
    line-height: 1;
  }

  .cart-drawer-gift-assignment-card__empty {
    margin: 0;
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    line-height: 1.4;
    color: #5f7184;
  }

  .cart-drawer-gift-message-dialog {
    position: fixed;
    inset: 0;
    width: min(760px, calc(100vw - 32px));
    background: #fff;
    border-radius: 0;
    padding: 20px;
    box-shadow: 0 18px 34px rgb(0 0 0 / 20%);
    max-height: calc(100vh - 32px);
    overflow: auto;
    height: fit-content;
    margin: auto;
    max-width: none;
    border: none;
  }

  .cart-drawer-gift-message-dialog[open] {
    inset: 0;
    margin: auto;
    animation: none;
  }

  .cart-drawer-gift-message-dialog::backdrop {
    background: rgb(0 0 0 / 35%);
  }

  .cart-drawer-gift-message-dialog .personalise-modal__content {
    display: flex;
    justify-content: center;
  }

  .cart-drawer-gift-message-modal__form {
    width: 100%;
    padding-right: 0;
  }

  .cart-drawer-gift-message-dialog .personalise-modal__close {
    cursor: pointer;
    right: 20px;
    top: 20px;
  }

  .cart-drawer-gift-message-modal__textarea {
    min-height: 120px;
    max-height: 240px;
  }

  .cart-drawer-gift-message-dialog .personalise-modal__actions {
    justify-content: flex-start;
  }

  .cart-drawer-gift-message-dialog .personalise-modal__save-button[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .cart-drawer__dialog {
    overflow: hidden;
  }

  .cart-drawer__inner {
    height: 100%;
    overflow: hidden;
  }

  .cart-drawer__content {
    height: calc(100% - var(--header-height));
    display: flex;
    flex-direction: column;
  }

  .cart-drawer__summary {
    background-color: var(--color-background);
    position: sticky;
    bottom: 0;
    z-index: 1;
  }
  .cart-drawer__summary-inner {
    width: 100%;
    padding: 15px;
  }
{% endstylesheet %}

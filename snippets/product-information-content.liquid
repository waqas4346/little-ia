{% doc %}
  Product Information Content

  Renders the product information layout with media gallery and product details.
  Used by both product-information and featured-product-information sections.

  @param {number} product_media_size - Number of media items in the product
  @param {string} section_id - Unique section ID
  @param {object} settings - Section settings object
  @param {string} media_gallery - Captured HTML for the product media gallery block
  @param {string} product_details - Captured HTML for the product details block
  @param {string} additional_blocks - Captured HTML for additional section blocks

  @example
  {% capture media_gallery %} 
    {% content_for 'block', type: '_product-media-gallery', id: 'media-gallery', closest.product: product %}
  {% endcapture %}

  {% capture product_details %}
    {% content_for 'block', type: '_product-details', id: 'product-details', closest.product: product %}
  {% endcapture %}

  {% capture additional_blocks %}
    {% content_for 'blocks' %}
  {% endcapture %}

  {% render 'product-information-content',
    product_media_size: product.media.size,
    section_id: section.id,
    settings: section.settings,
    media_gallery: media_gallery,
    product_details: product_details,
    additional_blocks: additional_blocks
  %}
{% enddoc %}

{% liquid
  # Determine render order based on media position
  if settings.desktop_media_position == 'left'
    assign render_order = 'media,product-details'
  else
    assign render_order = 'product-details,media'
  endif

  # Check if product has media
  assign product_has_media = true
  if product_media_size == 0
    assign product_has_media = false
  endif

  # Build product grid class
  assign product_grid_class = 'product-information__grid'

  if product_has_media == false
    assign product_grid_class = product_grid_class | append: ' product-information--media-none'
  elsif settings.desktop_media_position == 'right'
    assign product_grid_class = product_grid_class | append: ' product-information--media-right'
  else
    assign product_grid_class = product_grid_class | append: ' product-information--media-left'
  endif

  if settings.equal_columns
    assign product_grid_class = product_grid_class | append: ' product-information__grid--half'

    if settings.limit_details_width
      assign product_grid_class = product_grid_class | append: ' product-information__grid--limit-details'
    endif
  endif

  # Determine content width
  case settings.content_width
    when 'content-center-aligned'
      assign content_width = 'page-width'
    when 'content-full-width'
      assign content_width = 'full-width'
  endcase
%}

<div class="section-background color-{{ settings.color_scheme }}"></div>
<div
  class="product-information section section--{{ content_width }} spacing-style color-{{ settings.color_scheme }} relative"
  style="{% render 'spacing-style', settings: settings %} --gap: {{ settings.gap }}px;"
  data-testid="product-information"
>
  {% if request.page_type == 'product' %}
    <div class="product-breadcrumbs-wrapper">
      {% render 'product-breadcrumbs', product: product %}
    </div>
  {% endif %}
  {% if settings.desktop_media_position == 'left' and product_has_media and request.page_type == 'product' %}
    {% assign product_href = '#ProductInformation-' | append: section_id %}
    {% render 'skip-to-content-link', href: product_href, text: 'accessibility.skip_to_product_info' %}
  {% endif %}
  <div
    class="{{ product_grid_class }}"
    data-product-grid-content
  >
    {% assign render_order_array = render_order | split: ',' %}
    {% capture media %}
      <div
        class="product-information__media"
        data-testid="product-information-media"
      >
        {{ media_gallery }}
      </div>
    {% endcapture %}

    {% for block in render_order_array %}
      {% if block == 'media' and product_has_media %}
        {{ media }}
      {% elsif block == 'product-details' %}
        {{ product_details }}
      {% endif %}
    {% endfor %}
  </div>

  {{ additional_blocks }}
</div>

  {% stylesheet %}
  .product-information {
    gap: var(--gap) 0;
  }

  .product-breadcrumbs-wrapper {
    width: 100%;
  }

  .product-breadcrumbs-wrapper .blog-breadcrumbs {
    margin-top: 19px;
  }

  @media screen and (min-width: 750px) {
    .product-breadcrumbs-wrapper .blog-breadcrumbs {
      margin-top: 22px;
      margin-bottom: 18px;
    }
    
    .section--page-width .product-breadcrumbs-wrapper {
      max-width: var(--page-content-width);
      margin-left: auto;
      margin-right: auto;
      
    }
  }

  /* Base grid layout */
  .product-information__grid {
    display: grid;
    grid-template-columns: subgrid;
    grid-column: 1 / -1;
  }

  /* Default column positions */
  .product-details {
    order: 1;
  }

  .product-information__media {
    order: 0;
    width: 0;
    min-width: 100%;
  }

  /* Mobile: Reset order values for flexbox */
  @media screen and (max-width: 749px) {
    .product-details {
      order: unset;
    }

    .product-information__media {
      order: unset;
    }
  }

  .product-information__media .placeholder-image {
    width: 100%;
    height: 100%;
  }

  /* Mobile styles */
  @media screen and (max-width: 749px) {
    .product-information__grid {
      display: flex;
      flex-direction: column;
    }

    .product-details {
      grid-column: 1 / -1;
      display: contents;
    }

    .product-details > .group-block {
      display: contents;
    }

    .product-details > .group-block > .group-block-content {
      display: contents;
    }

    /* Header block (title and price) appears BEFORE media - must be first */
    /* Target the first group block that contains product title and price */
    .product-details > .group-block > .group-block-content > .group-block:first-child,
    .product-details > .group-block > .group-block-content > .group-block:has(h1):has(product-price),
    .product-details > .group-block > .group-block-content > .group-block:has(.text-block h1):has(product-price),
    .product-information__grid > .group-block:first-child,
    .product-information__grid > .group-block:has(h1):has(product-price),
    .product-information__grid > .group-block:has(.text-block h1):has(product-price) {
      order: -10 !important;
      width: 100% !important;
      padding-inline: var(--padding-lg) !important;
      margin-bottom: 16px !important;
      display: block !important;
      position: relative;
      z-index: 1;
    }

    /* Media appears AFTER header block */
    .product-information__media {
      order: -5 !important;
      grid-column: 1 / -1;
      width: 100%;
      min-width: 100%;
    }

    /* Variant picker appears after media */
    .product-details > .group-block > .group-block-content > *:has(variant-picker) {
      order: -1 !important;
      width: 100%;
      padding-inline: var(--padding-lg);
      margin-top: 16px;
      display: block;
    }

    /* Other product details appear after variant picker */
    .product-details > .group-block > .group-block-content > *:not(:first-child):not(:has(variant-picker)) {
      order: 0 !important;
      width: 100%;
      padding-inline: var(--padding-lg);
      display: block;
    }
  }

  /* Desktop styles */
  @media screen and (min-width: 750px) {
    .product-information__grid {
      grid-column: 2;
    }

    /* Position when there is no media */
    .product-information__grid.product-information--media-none {
      .product-details {
        width: var(--narrow-content-width);
        margin: 0 auto;
      }
    }

    /* Position when there is media */
    .product-information__grid:not(.product-information--media-none) {
      /* Media on the left side */
      &.product-information--media-left {
        grid-template-columns: 1fr min(50vw, var(--sidebar-width));

        .product-information__media {
          padding-right: calc(var(--gap, 0) / 2);
        }

        .product-details {
          padding-left: calc(var(--gap, 0) / 2);
        }

        &:has(.media-gallery--extend) {
          grid-column: 1 / 3;
        }
      }

      /* Media on the right side */
      &.product-information--media-right {
        grid-template-columns: min(50vw, var(--sidebar-width)) 1fr;

        .product-information__media {
          padding-left: calc(var(--gap, 0) / 2);
          order: 1;
        }

        .product-details {
          padding-right: calc(var(--gap, 0) / 2);
          order: 0;
        }

        &:has(.media-gallery--extend) {
          grid-column: 2 / -1;
        }
      }

      /* Equal width columns */
      &.product-information__grid--half,
      &.product-information__grid--half:has(.media-gallery--extend) {
        grid-column: 1 / -1;
        grid-template-columns:
          var(--full-page-grid-margin) calc(var(--full-page-grid-central-column-width) / 2) calc(
            var(--full-page-grid-central-column-width) / 2
          )
          var(--full-page-grid-margin);

        &.product-information--media-left {
          .product-information__media {
            grid-column: 2 / 3;

            &:has(.media-gallery--extend) {
              grid-column: 1 / 3;
            }
          }

          .product-details {
            grid-column: 3 / 4;
          }
        }

        &.product-information--media-right {
          .product-information__media {
            grid-column: 3 / 4;

            &:has(.media-gallery--extend) {
              grid-column: 3 / -1;
            }
          }

          .product-details {
            grid-column: 2 / 3;
          }
        }
      }
    }

    /* Handle full width section */
    .section--full-width {
      .product-information__grid:not(.product-information--media-none) {
        &.product-information--media-left,
        &.product-information--media-right {
          grid-column: 1 / -1;
        }

        &.product-information--media-left .product-details {
          padding-inline-end: var(--padding-lg);
        }

        &.product-information--media-right .product-details {
          padding-inline-start: var(--padding-lg);
        }

        &.product-information__grid--half.product-information--media-left {
          .product-information__media {
            grid-column: 1 / 3;
          }

          .product-details {
            grid-column: 3 / -1;
          }
        }

        &.product-information__grid--half.product-information--media-right {
          .product-information__media {
            grid-column: 3 / -1;
          }

          .product-details {
            grid-column: 1 / 3;
          }
        }
      }
    }
  }

  /* Wider sidebar for large screens */
  @media screen and (min-width: 1200px) {
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ).product-information--media-left {
      grid-template-columns: 2fr 1fr;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ).product-information--media-right {
      grid-template-columns: 1fr 2fr;
    }
  }

  /* Fixed layout for 1440px screen size */
  @media screen and (min-width: 1440px) {
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) {
      max-width: 1328px;
      margin: 0 auto;
      gap: 69px;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ).product-information--media-left {
      grid-template-columns: 701px 558px;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ).product-information--media-right {
      grid-template-columns: 558px 701px;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ).product-information--media-left .product-information__media {
      padding-right: 0;
      width: 701px;
      max-width: 701px;
      min-width: 701px;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ).product-information--media-left .product-details {
      padding-left: 0;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ).product-information--media-right .product-information__media {
      padding-left: 0;
      padding-top: 24px;
      width: 701px;
      max-width: 701px;
      min-width: 701px;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ).product-information--media-right .product-details {
      padding-right: 0;
    }

    /* Ensure images fill the container width */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media {
      width: 701px;
      max-width: 701px;
      min-width: 701px;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media media-gallery {
      width: 100%;
      max-width: 100%;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media .product-media-container {
      width: 100% !important;
      max-width: 100% !important;
    }

    /* Override constrain-height margins and ensure full width */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media .product-media-container.constrain-height {
      margin-right: 0 !important;
      margin-left: 0 !important;
      width: 100% !important;
      max-width: 100% !important;
      --constrained-height: none !important;
      --constrained-min-height: none !important;
      --viewport-offset: 0 !important;
      max-height: none !important;
    }

    /* Override the :where(.constrain-height) rule from base.css */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media :not(.dialog-zoomed-gallery) > .product-media-container:where(.constrain-height) {
      margin-right: 0 !important;
      margin-left: 0 !important;
      width: 100% !important;
      max-width: 100% !important;
      --constrained-height: unset !important;
      --constrained-min-height: unset !important;
      --viewport-offset: unset !important;
      max-height: unset !important;
      height: auto !important;
    }

    /* Override all product-media-container elements regardless of constrain-height */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media :not(.dialog-zoomed-gallery) > .product-media-container {
      --constrained-height: unset !important;
      max-height: unset !important;
    }

    /* Ensure product-media wrapper takes full width */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media .product-media {
      width: 100%;
      max-width: 100%;
    }

    /* Ensure image itself takes full width */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media .product-media__image {
      width: 100% !important;
      max-width: 100% !important;
      height: auto;
      display: block;
    }

    /* Override any image width constraints */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media .product-media-container img {
      width: 100% !important;
      max-width: 100% !important;
      height: auto;
    }

    /* Specifically target image inside constrain-height container */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media .product-media-container.constrain-height img,
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media .product-media-container.constrain-height .product-media__image {
      width: 100% !important;
      max-width: 100% !important;
      height: auto;
      margin: 0;
    }

    /* Override the constrain-height container's width calculation */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media :not(.dialog-zoomed-gallery) > .product-media-container.constrain-height {
      margin-right: 0 !important;
      margin-left: 0 !important;
      width: 100% !important;
      max-width: 100% !important;
      --constrained-height: none !important;
      max-height: none !important;
    }

    /* Target all slideshow wrapper elements */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media slideshow-component,
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media slideshow-container,
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media slideshow-slides,
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media slideshow-slide {
      width: 100% !important;
      max-width: 100% !important;
    }

    /* Target product-media-constraint-wrapper if it exists */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media .product-media-constraint-wrapper {
      width: 100% !important;
      max-width: 100% !important;
      margin: 0 !important;
    }

    /* Final override for constrain-height with all possible selectors */
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media slideshow-slide.product-media-container.constrain-height {
      margin-right: 0 !important;
      margin-left: 0 !important;
      width: 100% !important;
      max-width: 100% !important;
      --constrained-height: none !important;
      max-height: none !important;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media slideshow-slide.product-media-container.constrain-height .product-media,
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media slideshow-slide.product-media-container.constrain-height .product-media-constraint-wrapper .product-media {
      width: 100% !important;
      max-width: 100% !important;
    }

    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media slideshow-slide.product-media-container.constrain-height img,
    .product-information__grid:not(
        .product-information__grid--half,
        .product-information--media-none
      ) .product-information__media slideshow-slide.product-media-container.constrain-height .product-media__image {
      width: 100% !important;
      max-width: 100% !important;
      height: auto;
      display: block;
      margin: 0;
    }
  }

  .product-information__grid--limit-details .product-details > .group-block {
    max-width: var(--sidebar-width);
  }

  /* If the header is sticky, make product details content stick underneath the header */
  body:has(#header-group #header-component[data-sticky-state='active']) .product-details.sticky-content--desktop {
    --sticky-header-offset: var(--header-height);
  }

  /* Product title styling on product pages */
  .product-information .product-details h1,
  .product-information .product-details .text-block h1 {
    font-family: 'Outfit', sans-serif;
    font-style: normal;
    font-weight: 500;
    text-transform: capitalize;
    color: #1D425A;
  }

  @media screen and (min-width: 750px) {
    .product-information .product-details h1,
    .product-information .product-details .text-block h1 {
      font-size: 32px;
      line-height: 40px;
    }
  }

  @media screen and (max-width: 749px) {
    .product-information .product-details h1,
    .product-information .product-details .text-block h1 {
      font-size: 24px;
      line-height: 30px;
      display: flex;
      align-items: center;
    }
  }
{% endstylesheet %}

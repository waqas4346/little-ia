{% liquid
  assign block_settings = block.settings
%}

<script
  src="{{ 'component-cart-items.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>
<script
  src="{{ 'component-cart-quantity-selector.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>
<script
  src="{{ 'volume-pricing-info.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

<div
  {{ block.shopify_attributes }}
  class="cart-items__wrapper"
  {% if settings.product_title_case == 'uppercase' %}
    style="--product-title-case: uppercase;"
  {% endif %}
>
  {% if cart.empty? %}
    {%- if shop.customer_accounts_enabled and customer == null -%}
      <p>
        {{ 'actions.log_in_html' | t: link: routes.account_login_url }}
      </p>
    {%- endif -%}

    <a
      class="button cart-items__empty-button"
      href="{{ settings.empty_cart_button_link | default: routes.all_products_collection_url }}"
    >
      {{ 'actions.continue_shopping' | t }}
    </a>
  {%- else -%}
    <span
      class="visually-hidden"
      ref="cartItemCount"
      aria-hidden="true"
    >
      {{- cart.item_count -}}
    </span>
    <form
      action="{{ routes.cart_url }}"
      class="cart-form"
      id="cart-form"
      method="post"
    >
      <div
        class="cart-items spacing-style{% if block_settings.dividers %} cart-items--dividers{% endif %}"
        style="{%  render 'spacing-style', settings: block_settings %} --cart-items-gap:{{ block_settings.gap | append: "px" }};"
      >
        <table
          class="cart-items__table"
          role="table"
        >
          <caption
            class="visually-hidden"
            role="caption"
          >
            {{ 'content.cart_total' | t }}
            <span>{{ cart.total_price | money_with_currency }}</span>
          </caption>

          <thead
            class="visually-hidden"
            role="rowgroup"
          >
            <tr
              role="row"
              class="cart-items__table-row"
            >
              <th
                id="productImage"
                scope="col"
                role="columnheader"
              >
                {{ 'content.product_image' | t }}
              </th>
              <th
                id="productInformation"
                scope="col"
                role="columnheader"
              >
                {{ 'content.product_information' | t }}
              </th>
              <th
                id="quantity"
                scope="col"
                role="columnheader"
              >
                {{ 'content.quantity' | t }}
              </th>
              <th
                id="productTotal"
                scope="col"
                role="columnheader"
              >
                {{ 'content.product_total' | t }}
              </th>
            </tr>
          </thead>

          <tbody role="rowgroup">
            {% for item in cart.items %}
              <tr
                role="row"
                class="cart-items__table-row{% if item.parent_relationship.parent != null %} cart-items__nested-line{% endif %}"
                ref="cartItemRows[]"
                data-parent-key="{{ item.parent_relationship.parent.key }}"
                data-key="{{ item.key }}"
              >
                <td
                  class="cart-items__media"
                  role="cell"
                  headers="productImage"
                >
                  {% if item.image -%}
                    {% liquid
                      assign ratio = 1
                      assign border_opacity = settings.cart_thumbnail_border_opacity | divided_by: 100.0
                      assign border_override = '--border-width: [cart_thumbnail_border_width]px; --border-style: [cart_thumbnail_border_style]; --border-color: rgb(var(--color-border-rgb) / [cart_thumbnail_border_opacity]); --border-radius: [cart_thumbnail_border_radius]px;' | replace: '[cart_thumbnail_border_width]', settings.cart_thumbnail_border_width | replace: '[cart_thumbnail_border_style]', settings.cart_thumbnail_border | replace: '[cart_thumbnail_border_opacity]', border_opacity | replace: '[cart_thumbnail_border_radius]', settings.cart_thumbnail_border_radius

                      if settings.cart_thumbnail_border_radius > 0
                        assign border_override = border_override | append: ' overflow: hidden;'
                      endif
                      if block_settings.image_ratio == 'portrait'
                        assign ratio = 0.8
                      elsif block_settings.image_ratio == 'adapt'
                        assign ratio = item.image.aspect_ratio
                      endif
                    %}
                    <a
                      href="{{ item.url }}"
                      class="cart-items__media-container"
                      style="--ratio:{{ ratio }};"
                    >
                      {%- liquid
                        echo item.image | image_url: width: 250 | image_tag: class: 'cart-items__media-image border-style', style: border_override
                      -%}
                    </a>
                  {%- endif %}
                </td>
                <td
                  class="cart-items__details cart-primary-typography"
                  role="cell"
                  headers="productInformation"
                >
                  <p>
                    <a
                      href="{{ item.url }}"
                      class="cart-items__title"
                      {% if item.parent_relationship.parent != null %}
                        aria-label="{{ 'accessibility.nested_product' | t: product_title: item.product.title, parent_title: item.parent_relationship.parent.title | escape }}"
                      {% endif %}
                    >
                      {{- item.product.title -}}
                    </a>
                  </p>
                  {% if item.product.vendor and block_settings.vendor %}
                    <p>
                      {{ item.product.vendor }}
                    </p>
                  {% endif %}

                  {%- if item.item_components.size != 0 -%}
                    <ul class="cart-items__bundle list-unstyled">
                      {%- for component in item.item_components -%}
                        <li>
                          {{- component.title -}}
                          {%- if component.quantity > 1 -%}
                            <span> Ã— {{ component.quantity }}</span>
                          {%- endif -%}
                        </li>
                      {%- endfor -%}
                    </ul>
                  {%- endif -%}

                  {%- liquid
                    # Check for personalization properties
                    assign has_personalization = false
                    assign personalization_properties = ''
                    assign personalization_summary = ''
                    assign non_personalization_properties = ''
                    
                    # List of personalization property names
                    assign personalization_keys = "Name,Name 1,Name 2,Name 3,Name 4,Baby's Name,Kid's Name,Mum's Name,Date of Birth,Personalise Date of Birth,Text Color,Text Font,School Year,Personalisation:,Message,Time,Weight" | split: ','
                    
                    # Separate personalization and non-personalization properties
                    for property in item.properties
                      assign property_first_char = property.first | slice: 0
                      if property.last != blank and property_first_char != '_'
                        assign is_personalization = false
                        for key in personalization_keys
                          if property.first == key
                            assign is_personalization = true
                            assign has_personalization = true
                            break
                          endif
                        endfor
                        
                        if is_personalization
                          if personalization_properties != ''
                            assign personalization_properties = personalization_properties | append: '|'
                          endif
                          assign personalization_properties = personalization_properties | append: property.first | append: ':' | append: property.last
                          
                          # Build summary with just values
                          if personalization_summary != ''
                            assign personalization_summary = personalization_summary | append: ' | '
                          endif
                          assign personalization_summary = personalization_summary | append: property.last
                        else
                          if non_personalization_properties != ''
                            assign non_personalization_properties = non_personalization_properties | append: '|'
                          endif
                          assign non_personalization_properties = non_personalization_properties | append: property.first | append: ':' | append: property.last
                        endif
                      endif
                    endfor
                  -%}

                  {%- if item.product.has_only_default_variant == false
                    or non_personalization_properties != ''
                    or item.selling_plan_allocation != null
                  -%}
                    <dl class="cart-items__variants">
                      {%- if item.product.has_only_default_variant == false and item.item_components.size == 0 -%}
                        {%- for option in item.options_with_values -%}
                          <div class="cart-items__variant">
                            <dt class="visually-hidden">{{ option.name }}:</dt>
                            <dd>
                              {{- option.value -}}
                              {%- if forloop.last != true %},&nbsp;{% endif -%}
                            </dd>
                          </div>
                        {%- endfor -%}
                      {%- endif -%}

                      {%- comment -%} Display only non-personalization properties {%- endcomment -%}
                      {%- for property in item.properties -%}
                        {%- assign property_first_char = property.first | slice: 0 -%}
                        {%- if property.last != blank and property_first_char != '_' -%}
                          {%- assign is_personalization_prop = false -%}
                          {%- for key in personalization_keys -%}
                            {%- if property.first == key -%}
                              {%- assign is_personalization_prop = true -%}
                              {%- break -%}
                            {%- endif -%}
                          {%- endfor -%}
                          {%- unless is_personalization_prop -%}
                            <div class="cart-items__properties">
                              <dt>{{ property.first }}:</dt>
                              <dd>
                                {%- if property.last contains '/uploads/' -%}
                                  <a href="{{ property.last }}">{{ property.last | split: '/' | last }}</a>
                                {%- else -%}
                                  {{ property.last }}
                                {%- endif -%}
                              </dd>
                            </div>
                          {%- endunless -%}
                        {%- endif -%}
                      {%- endfor -%}
                    </dl>

                    {% if item.selling_plan_allocation %}
                      <p>{{ item.selling_plan_allocation.selling_plan.name }}</p>
                    {% endif %}
                  {%- endif -%}
                  
                  {% if item.line_level_discount_allocations.size > 0 %}
                    <ul
                      class="list-unstyled"
                      role="list"
                    >
                      {%- for discount in item.line_level_discount_allocations -%}
                        <li>{{ discount.discount_application.title | escape }}</li>
                      {%- endfor -%}
                    </ul>
                  {% endif %}

                  <div>
                    {%- liquid
                      assign compare_price = item.variant.compare_at_price
                      assign current_price = item.final_price
                      if item.original_price != item.final_price
                        assign current_price = item.final_price
                        if item.variant.compare_at_price > item.original_price
                          assign compare_price = item.variant.compare_at_price
                        else
                          assign compare_price = item.original_price
                        endif
                      else
                        assign current_price = item.original_price
                        if item.variant.compare_at_price > item.original_price
                          assign compare_price = item.variant.compare_at_price
                        endif
                      endif
                      
                      if compare_price > current_price
                        assign price_difference = compare_price | minus: current_price
                        assign percentage_off = price_difference | times: 100.0 | divided_by: compare_price | floor
                      endif
                    -%}
                    {% if item.original_price != item.final_price %}
                      <span class="visually-hidden">{{ 'content.price_sale' | t }}</span>
                      <span>{{ item.final_price | money }}</span>
                      <span class="visually-hidden">{{ 'content.price_regular' | t }}</span>
                      <s class="compare-at-price">
                        {% if item.variant.compare_at_price > item.original_price %}
                          {{ item.variant.compare_at_price | money }}
                        {% else %}
                          {{ item.original_price | money }}
                        {% endif %}
                      </s>
                      {% if compare_price > current_price %}
                        <span class="cart-items__percentage-off">{{ percentage_off }}% OFF</span>
                      {% endif %}
                    {% else %}
                      {% if item.variant.compare_at_price > item.original_price %}
                        <span class="visually-hidden">{{ 'content.price_sale' | t }}</span>
                      {% else %}
                        <span class="visually-hidden">{{ 'content.price' | t }}</span>
                      {% endif %}

                      <span>{{ item.original_price | money }}</span>

                      {% if item.variant.compare_at_price > item.original_price %}
                        <span class="visually-hidden">{{ 'content.price_regular' | t }}</span>
                        <s class="compare-at-price">{{ item.variant.compare_at_price | money }}</s>
                        {% if compare_price > current_price %}
                          <span class="cart-items__percentage-off">{{ percentage_off }}% OFF</span>
                        {% endif %}
                    {% endif %}
                  {% endif %}
                  </div>
                </td>
                <td
                  class="cart-items__quantity"
                  role="cell"
                  headers="quantity"
                >
                  {% # Here I want to pass some arguments to the quantity block so it knows which value should the input be set to. Though quantity block could be a snippet instead %}
                  {% assign can_update_quantity = item.instructions.can_update_quantity
                    | default: true, allow_false: true
                  %}
                  <div class="cart-items__quantity-controls">
                    {% render 'volume-pricing-info', variant: item.variant, unique_id: item.index, quantity: item.quantity %}

                    {% render 'quantity-selector',
                      product: item.product,
                      variant: item.variant,
                      in_cart_quantity: item.quantity,
                      line_index: item.index,
                      class: 'cart-primary-typography',
                      can_update_quantity: can_update_quantity
                    %}

                    <button
                      class="button button--tertiary cart-items__remove"
                      type="button"
                      aria-label="{{ 'accessibility.remove_item' | t: title: item.title | escape }}"
                      on:click="/onLineItemRemove/{{ item.index | plus: 1 }}"
                      {% assign can_remove = item.instructions.can_remove | default: true, allow_false: true %}
                      {% if can_remove == false %}
                        hidden
                      {% endif %}
                    >
                      Remove
                      {% comment %} {{- 'icon-delete.svg' | inline_asset_content -}} {% endcomment %}
                      <span class="visually-hidden">{{ 'accessibility.remove' | t }}</span>
                    </button>
                  </div>
                </td>
                <td
                  class="cart-items__error hidden"
                  role="cell"
                  ref="cartItemErrorContainer-{{ item.index | plus: 1 }}"
                  headers="quantity"
                >
                  <div
                    class="cart-item__error"
                    role="alert"
                  >
                    <span class="svg-wrapper">
                      {{- 'icon-error.svg' | inline_asset_content -}}
                    </span>
                    <small
                      class="cart-item__error-text cart-primary-typography"
                      ref="cartItemError-{{ item.index | plus: 1 }}"
                    ></small>
                  </div>
                </td>
                <td
                  class="cart-items__price cart-secondary-typography"
                  role="cell"
                  headers="productTotal"
                >
                  {%- liquid
                    if settings.currency_code_enabled_cart_items
                      assign price = item.final_line_price | money_with_currency
                      assign unit_price = item.unit_price | money_with_currency
                    else
                      assign price = item.final_line_price | money
                      assign unit_price = item.unit_price | money
                    endif
                  -%}
                  <text-component value="{{ price | strip_html }}">{{ price }}</text-component>
                  {%- if item.unit_price_measurement -%}
                    <div class="cart-items__price-unit cart-secondary-typography">
                      {% render 'unit-price', price: unit_price, measurement: item.unit_price_measurement %}
                    </div>
                  {%- endif -%}
                </td>
              </tr>
              
              {%- comment -%} Add Edit Personalization button in a separate row spanning all columns {%- endcomment -%}
              {%- if has_personalization -%}
              <tr
                class="cart-items__personalization-row"
                role="row"
                data-cart-line="{{ item.index | plus: 1 }}"
              >
                <td
                  class="cart-items__personalization-button-cell"
                  role="cell"
                  colspan="4"
                >
                  <button
                    type="button"
                    class="cart-items__edit-personalization button-unstyled{% if personalization_summary != blank %} has-summary{% endif %}"
                    data-cart-line="{{ item.index | plus: 1 }}"
                    data-product-id="{{ item.product.id }}"
                    data-variant-id="{{ item.variant.id }}"
                    data-personalization-properties="{{ personalization_properties | escape }}"
                  >
                    {%- if personalization_summary != blank -%}
                    <span class="cart-items__edit-personalization-summary">
                      <span class="cart-items__edit-personalization-summary-label">Personalised:</span> {{ personalization_summary }}
                    </span>
                    {%- endif -%}
                    <div class="icon-tex-container">
                      <span class="cart-items__edit-personalization-icon">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                          <rect width="18" height="18" fill="url(#pattern0_860_35083)"/>
                          <defs>
                          <pattern id="pattern0_860_35083" patternContentUnits="objectBoundingBox" width="1" height="1">
                          <use xlink:href="#image0_860_35083" transform="scale(0.00195312)"/>
                          </pattern>
                          <image id="image0_860_35083" width="512" height="512" preserveAspectRatio="none" xlink:href="data:image/png;base64,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"/>
                          </defs>
                        </svg>
                      </span>
                      <span class="cart-items__edit-personalization-text">EDIT</span>
                    </div>
                  </button>
                </td>
              </tr>
              {%- endif -%}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </form>
  {%- endif -%}
</div>

{% stylesheet %}
  .cart-items {
    --cart-item-media-width-min: 2.5rem;
    --cart-item-media-width-max: 7.5rem;

    container-name: cart-items;
    container-type: inline-size;
    width: 100%;
  }

  .cart-items-disabled {
    pointer-events: none;
  }

  .cart-items__table {
    width: 100%;
  }

  .cart-items__table * {
    margin: 0;
  }

  .cart-items__table-row {
    --cart-item-price-width: 6rem;

    display: grid;
    grid-template-columns: clamp(2.5rem, 15cqi, 7.5rem) minmax(0, 1fr) minmax(var(--cart-item-price-width), auto);
    grid-template-areas:
      'media details price'
      'media quantity price'
      'media error error';
    column-gap: var(--gap-md);
    align-items: start;
    padding-top: 14px;
    padding-bottom: 14px;
    margin-bottom: 0;
  }

  .cart-items__table-row.cart-items__nested-line td:first-child {
    width: 60%;
    justify-self: right;
  }

  html:active-view-transition-type(page-navigation) .cart-items__table-row {
    /* stylelint-disable-next-line declaration-no-important */
    view-transition-name: none !important;
  }

  .cart-items__table-row.removing {
    overflow: hidden;
    animation: removeRow calc(var(--animation-speed) * 2) var(--animation-easing) forwards;
    animation-delay: var(--animation-speed);
  }

  @keyframes removeRow {
    0% {
      height: var(--row-height);
    }

    100% {
      opacity: 0;
      height: 0;
      padding-bottom: 0;
      margin-bottom: 0;
      border-color: transparent;
    }
  }

  .cart-items__table-row:last-child {
    padding-bottom: 0;
  }

  .cart-items--dividers .cart-items__table-row {
    border-bottom: 1px solid var(--color-border);
    margin-bottom: var(--cart-items-gap);
  }

  .cart-items--dividers .cart-items__table-row:has(+ .cart-items__nested-line) {
    border-bottom: none;
    margin-bottom: 0;
  }

  .cart-items--dividers .cart-items__table-row:last-child {
    border-block-end: none;
    padding-block-end: 0;
    margin-bottom: 0;
  }

  .cart-items__details {
    grid-area: details;
    color: rgb(var(--color-foreground-rgb));
  }

  .cart-items__details > * + *,
  .cart-items__bundle li {
    margin-block-start: var(--margin-2xs);
  }

  .cart-items__details * {
    font-size: var(--cart-font-size--sm);
  }

  .cart-items__details a {
    text-decoration: none;
  }

  .cart-items__title {
    font-size: var(--cart-font-size--md);
    color: var(--color-foreground);
    text-transform: var(--product-title-case);
  }

  .cart-items__variant {
    display: inline-block;
  }

  .cart-items__quantity {
    grid-area: quantity;
    margin-block-start: var(--margin-xs);
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: var(--gap-xs);
    width: fit-content;
  }

  .cart-items__quantity-controls {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: var(--gap-xs);
    width: fit-content;
  }

  .cart-items__quantity-controls > .volume-pricing-info {
    margin-inline-start: calc(-1 * var(--minimum-touch-target) - var(--gap-xs));
  }

  .cart-items__quantity .quantity-selector {
    display: inline-flex;
    font-size: var(--cart-font-size--sm);
    height: auto;
  }

  .cart-items__remove {
    background-color: transparent;
    color: var(--color-foreground);
    width: var(--minimum-touch-target);
    height: var(--minimum-touch-target);
    justify-content: center;
    box-shadow: none;
    padding: 0;
  }

  .cart-items__media {
    grid-area: media;
    padding: 0;
  }

  .cart-items__price {
    grid-area: price;
    min-height: unset;
    min-width: var(--cart-item-price-width);
    text-align: end;
    display: block;
    font-size: var(--cart-font-size--md);
  }

  .cart-items__price-unit {
    font-size: var(--cart-font-size--xs);
  }

  .cart-items__media-container {
    display: flex;
    aspect-ratio: var(--ratio);
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .cart-items__media-image {
    aspect-ratio: inherit;
    object-fit: cover;
    object-position: center center;
    width: 100%;
    height: auto;
  }

  .cart-items__empty-button {
    margin-top: var(--margin-md);
    padding-inline: var(--padding-4xl);
    padding-block: var(--padding-lg);
  }

  /* Error message */
  .cart-items__error {
    display: flex;
    align-items: flex-start;
    width: 100%;
    grid-area: error;
    margin-block-start: var(--margin-xs);
    opacity: 1;
    overflow: hidden;
    transform: translateY(0);
    transition: opacity var(--drawer-animation-speed) var(--animation-easing),
      transform var(--drawer-animation-speed) var(--animation-easing);

    @starting-style {
      opacity: 0;
      transform: translateY(-0.5rem);
    }
  }

  .cart-item__error {
    display: flex;
    align-items: flex-start;
    width: 100%;
    font-size: var(--cart-font-size--sm);
    padding-block: var(--padding-2xs);
  }

  .cart-item__error .svg-wrapper {
    flex-shrink: 0;
    width: var(--icon-size-xs);
    height: var(--icon-size-xs);
    margin-inline: var(--margin-3xs) var(--margin-xs);
    margin-block-start: var(--margin-3xs);
  }

  @container cart-items (min-width: 720px) {
    .cart-items__table-row {
      --cart-item-price-width: 6rem;

      grid-template-columns: 7.5rem 1fr 1fr minmax(var(--cart-item-price-width), auto);
      grid-template-rows: min-content 1fr;
      grid-template-areas:
        'media details quantity price'
        'media details error error';
    }

    .cart-items__quantity,
    .cart-items__price {
      grid-area: initial;
    }

    .cart-items__quantity {
      margin-top: 0;
    }

    .cart-items__price {
      min-height: var(--minimum-touch-target);
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: center;
    }
  }

  .cart__original-total-container,
  .cart__total-container {
    display: flex;
    flex-direction: column;
  }

  .cart__total-container {
    margin-bottom: 12px;
    row-gap: var(--gap-2xs);

    &.cart__total-container--has-installments {
      row-gap: var(--gap-xs);
    }
  }

  .cart__original-total-container:empty {
    display: none;
  }

  .cart__summary-totals {
    display: flex;
    flex-direction: column;
    width: 100%;
    border-block-start: none;

    &:has(> :first-child:not(.cart__original-total-container, .cart__total-container)) {
      padding-block-start: 0;
      border-block-start: none;
    }

    @media screen and (min-width: 750px) {
      padding-block-start: 0;
    }
  }

  .cart__original-total-container,
  .cart__original-total-container * {
    font-size: var(--cart-font-size--sm);
  }

  .cart__total {
    font-weight: var(--font-weight-bold);
  }

  .cart__total-label {
    font-size: var(--cart-font-size--sm);
  }

  .cart__total-value {
    font-size: var(--cart-font-size--2xl);
  }

  .cart-primary-typography {
    font-family: var(--cart-primary-font-family);
    font-style: var(--cart-primary-font-style);
    font-weight: var(--cart-primary-font-weight);
  }

  .cart-secondary-typography {
    font-family: var(--cart-secondary-font-family);
    font-style: var(--cart-secondary-font-style);
    font-weight: var(--cart-secondary-font-weight);
  }

  .cart__ctas {
    width: 100%;
    display: grid;
    gap: var(--checkout-button-gap);
    grid-auto-flow: row;
    grid-template-columns: 1fr;
  }

  .cart__additional-checkout-buttons {
    width: 100%;
  }

  .cart__ctas .cart__checkout-button {
    width: 100%;
    height: clamp(25px, var(--height-buy-buttons), 55px);
    padding-inline: var(--padding-4xl);
  }

  shopify-accelerated-checkout-cart {
    --shopify-accelerated-checkout-inline-alignment: center;
    --shopify-accelerated-checkout-button-border-radius: var(--style-border-radius-buttons-primary);
    --shopify-accelerated-checkout-row-gap: var(--checkout-button-gap, 10px);
  }

  .cart-note {
    width: 100%;
  }

  @starting-style {
    .cart-note[open-by-default-on-desktop][open-by-default-on-mobile] .details-content {
      block-size: auto;
      opacity: 1;
      overflow-y: visible;
    }
  }

  .cart-note__inner {
    padding-block: var(--padding-2xs) var(--padding-sm);
  }

  .cart-note__summary {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .cart-note__summary:hover {
    color: rgb(var(--color-foreground-rgb) / var(--opacity-subdued-text));
  }

  .cart-note__label {
    display: flex;
    align-items: flex-start;
    gap: var(--gap-2xs);
    font-size: var(--cart-font-size--sm);
  }

  .cart-note__instructions {
    color: var(--color-input-text);
    background-color: var(--color-input-background);
    border-width: var(--style-border-width-inputs);
    border-color: var(--color-input-border);
    transition: box-shadow var(--animation-speed) ease;
    box-shadow: var(--input-box-shadow);
    min-height: 5.5rem;
    min-width: 100%;
    max-width: 100%;
    font-size: var(--cart-font-size--sm);
    padding: max(4px, calc(var(--style-border-radius-inputs) * (1 - cos(45deg))));
  }

  .cart-note .svg-wrapper {
    height: var(--icon-size-sm);
    width: var(--icon-size-sm);
    margin: 0;
  }

  .cart-note .icon-plus {
    height: var(--icon-size-xs);
    width: var(--icon-size-xs);
  }

  /* Remove animation */
  .remove-icon-bottom,
  .remove-icon-top {
    transition: transform var(--animation-speed) var(--animation-easing);
  }

  .cart-items__remove:hover .remove-icon-top {
    transform: translate(calc(-1 * var(--icon-stroke-width)), var(--icon-stroke-width)) rotate(-15deg);
  }

  .cart-items__remove:is(:hover, :active) .remove-icon-bottom {
    transform: translateY(var(--icon-stroke-width));
  }

  .cart-items__table-row.removing .remove-icon-bottom {
    transform: translateY(0);
  }

  .cart-items__table-row.removing .remove-icon-top {
    animation: removeButtonClickedIconTop var(--animation-speed) var(--animation-easing) forwards;
  }

  @keyframes removeButtonClickedIconTop {
    50% {
      transform: translate(0, calc(-1 * var(--icon-stroke-width)));
    }

    100% {
      transform: translate(0, 0);
    }
  }

  .cart-items__properties {
    display: block;
    margin-block-start: var(--margin-2xs);
  }

  .cart-items__properties dt,
  .cart-items__properties dd {
    display: inline;
  }

  .cart-items__personalization-row {
    display: table-row;
  }

  .cart-items__personalization-button-cell {
    padding-bottom: 14px;
    border: none;
    width: 100%;
    border-bottom: var(--style-border-width) solid var(--color-border);
  }

  .cart-items__edit-personalization {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 8px 12px;
    background-color: #F1F1F1;
    color: #7295BB;
    text-transform: uppercase;
    font-weight: 500;
    font-size: var(--font-size--sm);
    cursor: pointer;
    margin-top: -5px;
    border: 1px solid #F1F1F1;
  }

  .cart-items__edit-personalization:hover {
    background-color: #ffffff;
    border-color: #7295BB;
    color: #7295BB;
  }

  .cart-items__edit-personalization-summary {
    display: inline-block;
    margin-right: var(--margin-sm);
    flex-shrink: 0;
    color: #1D425A;
    font-weight: 500;
    line-height: 1.4;
    text-transform: none;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .cart-items__edit-personalization-summary-label {
    font-weight: 400;
  }

  .cart-items__edit-personalization .icon-tex-container {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }

  .cart-items__edit-personalization-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  .cart-items__edit-personalization-icon svg {
    width: 100%;
    height: 100%;
    fill: currentColor;
  }

  .cart-items__edit-personalization-text {
    line-height: 1;
  }
{% endstylesheet %}

<script>
  // Handle cart personalization editing
  (function() {
    'use strict';
    
    // Use event delegation to handle dynamically added buttons
    function handleClick(e) {
      const button = e.target.closest('.cart-items__edit-personalization');
      if (button && button.dataset.cartLine && button.dataset.personalizationProperties) {
        e.preventDefault();
        e.stopPropagation();
        handleCartPersonalizationClick(e, button);
      }
    }
    
    // Initialize when DOM is ready
    function init() {
      try {
        // Set up event delegation - listen on document to catch all buttons
        document.addEventListener('click', handleClick, true);
      } catch (err) {
        console.error('Error initializing cart personalization:', err);
      }
    }
    
    function handleCartPersonalizationClick(e, buttonElement) {
      try {
        const button = buttonElement || e.currentTarget;
        const cartLine = button.dataset.cartLine;
        const productId = button.dataset.productId;
        const variantId = button.dataset.variantId;
        const propertiesString = button.dataset.personalizationProperties || '';
        
        // Parse properties string (format: "key1:value1|key2:value2")
        const properties = {};
        if (propertiesString) {
          const pairs = propertiesString.split('|');
          pairs.forEach(pair => {
            const [key, ...valueParts] = pair.split(':');
            if (key && valueParts.length > 0) {
              properties[key] = valueParts.join(':');
            }
          });
        }
        
        // Store cart context in window for modal to access
        window.cartPersonalizationContext = {
          cartLine: parseInt(cartLine, 10),
          productId: productId,
          variantId: variantId,
          properties: properties
        };
        
        // Convert cart properties to personalization data format
        const personalisationData = {
          name: properties['Name'] || null,
          name1: properties['Name 1'] || null,
          name2: properties['Name 2'] || null,
          name3: properties['Name 3'] || null,
          name4: properties['Name 4'] || null,
          babyName: properties['Baby\'s Name'] || null,
          kidName: properties['Kid\'s Name'] || null,
          mumName: properties['Mum\'s Name'] || null,
          dob: properties['Date of Birth'] || null,
          optionalDob: properties['Personalise Date of Birth'] || null,
          schoolYear: properties['School Year'] || null,
          color: properties['Text Color'] || null,
          font: properties['Text Font'] || null,
          textbox: properties['Personalisation:'] || null,
          message: properties['Message'] || null,
          time: properties['Time'] || null,
          weight: properties['Weight'] || null
        };
        
        // Save to sessionStorage with product ID
        const key = `personalisation_${productId}`;
        sessionStorage.setItem(key, JSON.stringify(personalisationData));
        
        // Find and open the personalisation modal - look for cart drawer modal specifically
        function tryOpenModal(attempts) {
          attempts = attempts || 0;
          const maxAttempts = 50;
          
          try {
            // First, try to find the cart drawer modal specifically by ID
            let dialog = document.getElementById('personalise-dialog-cart');
            
            // If not found by ID, search inside cart drawer component
            if (!dialog) {
              const cartDrawer = document.querySelector('cart-drawer-component');
              if (cartDrawer) {
                // Search for modal with cart-drawer context attribute
                dialog = cartDrawer.querySelector('personalise-dialog[data-context="cart-drawer"]') ||
                         cartDrawer.querySelector('#personalise-dialog-cart');
                
                // Also check inside the cart drawer dialog
                if (!dialog) {
                  const drawerDialog = cartDrawer.querySelector('dialog');
                  if (drawerDialog) {
                    dialog = drawerDialog.querySelector('personalise-dialog[data-context="cart-drawer"]') || 
                             drawerDialog.querySelector('#personalise-dialog-cart');
                  }
                }
              }
            }
            
            // Fallback: search globally for cart drawer modal
            if (!dialog) {
              dialog = document.querySelector('personalise-dialog[data-context="cart-drawer"]') ||
                       document.querySelector('#personalise-dialog-cart');
            }
            
            if (dialog) {
              const isCustomElementDefined = customElements.get('personalise-dialog');
              
              if (isCustomElementDefined) {
                if (typeof dialog.showDialog === 'function') {
                  try {
                    dialog.showDialog();
                    console.log('Modal opened via showDialog');
                    return;
                  } catch (err) {
                    console.warn('Error calling showDialog:', err);
                  }
                }
              }
              
              // Fallback: try opening inner dialog element
              const innerDialog = dialog.querySelector && dialog.querySelector('dialog');
              if (innerDialog && typeof innerDialog.showModal === 'function') {
                try {
                  innerDialog.showModal();
                  console.log('Modal opened via inner dialog');
                  return;
                } catch (err) {
                  console.warn('Error opening inner dialog:', err);
                }
              }
            }
            
            if (attempts < maxAttempts) {
              setTimeout(function() {
                tryOpenModal(attempts + 1);
              }, 100);
            } else {
              console.error('Could not find or open personalisation modal after', maxAttempts, 'attempts');
            }
          } catch (err) {
            console.error('Error in tryOpenModal:', err);
          }
        }
        
        tryOpenModal(0);
      } catch (err) {
        console.error('Error handling cart personalization click:', err);
      }
    }
    
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      setTimeout(init, 100);
    }
  })();
</script>
